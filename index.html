<!DOCTYPE html>

<html lang="ko">
  <head>
    <title>주소 찾기</title>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,height=device-height,initial-scale=1.0"
    />
  </head>
  <body onload="execDaumPostcode()">
    <div
      id="layer"
      style="display:block; position:absolute; overflow:hidden; z-index:1; -webkit-overflow-scrolling:touch; "
    ></div>
    <!--<script src="https://spi.maps.daum.net/imap/map_js_init/postcode.v2.js"></script> 원래쓰던코드-->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey="1103ccc58c7cea779430c65a44553748"&libraries=services"></script>
    
    <script>
      window.addEventListener("message", onReceivedPostMessage, false);

      function onReceivedPostMessage(event) {
        //..ex deconstruct event into action & params
        var action = event.data.action;
        var params = event.data.params;
        console.log("onReceivedPostMessage " + event);
      }

      function onReceivedActivityMessageViaJavascriptInterface(json) {
        //..ex deconstruct data into action & params
        var data = JSON.parse(json);
        var action = data.action;
        var params = data.params;
        console.log("onReceivedActivityMessageViaJavascriptInterface " + event);
      }

      function postMessageToiOS(postData) {
        window.webkit.messageHandlers.callBackHandler.postMessage(postData); //iOS용-사용X
      }
      
      function postMessageToAndroid(postData) {
    // 1. 'AndroidBridge'는 안드로이드 네이티브 코드에서 설정한
    //    JavascriptInterface의 이름이어야 합니다. (이름은 다를 수 있습니다)
    // 2. 안드로이드는 객체(object)를 바로 받지 못하므로,
    //    JSON 문자열(string)로 변환해서 보냅니다.
    if (window.AndroidBridge && typeof window.AndroidBridge.postMessage === 'function') {
        window.AndroidBridge.postMessage(JSON.stringify(data));
    } else {
        console.log("AndroidBridge is not available.");
        // 안드로이드 환경이 아닐 때 테스트용 로그
        console.log("전송할 데이터:", data);}
    }

      var element_layer = document.getElementById("layer");
      var geocoder = new daum.maps.services.Geocoder(); //주소-좌표 변환 객체
      
      function execDaumPostcode() {
        new daum.Postcode({
          oncomplete: function (data) {
            geocoder.addressSearch(data.address, function(results, status) {
              if (status === daum.maps.services.Status.OK) {
                var result = results[0]; //첫번째 결과의 값을 활용
                var postData = {
                  x: result.x,                 // 경도
                  y: result.y,                 // 위도
                  roadAddress: data.roadAddress  // 도로명주소 (바깥 'data' 객체에서 가져옴)
                };
                postMessageToAndroid(postData);
              } else {
                // 검색 실패 시
                console.log("좌표 검색에 실패했습니다.");
              }
            });
          },
          width: "100%",
          height: "100%",
        }).embed(element_layer);
        element_layer.style.display = "block";
        initLayerPosition();
      }

      function initLayerPosition() {
        var width = window.innerWidth || document.documentElement.clientWidth;
        var height =
          window.innerHeight || document.documentElement.clientHeight;
        element_layer.style.width = width + "px";
        element_layer.style.height = height + "px";
        element_layer.style.left =
          ((window.innerWidth || document.documentElement.clientWidth) -
            width) /
            2 +
          "px";
        element_layer.style.top =
          ((window.innerHeight || document.documentElement.clientHeight) -
            height) /
            2 +
          "px";
      }
    </script>
  </body>
</html>



